{"id":"pando-11r","content_hash":"18def3e69f50c1c70cb3799210e6759b52a6fe081933b9109a27035ec8b0abf4","title":"Implement config:init command","description":"Implement src/commands/config/init.ts:\n\n- Determine target directory (global, git-root, or current)\n- Determine filename (.pando.toml or config.toml)\n- Check file existence (handle --force)\n- Generate TOML content with comments\n- Write file with appropriate permissions\n- Output success message with next steps\n\nNote: No test file exists yet, needs creation in test/commands/config/init.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:12.211406-06:00","updated_at":"2025-11-13T04:29:46.981193-06:00","closed_at":"2025-11-13T04:29:46.981193-06:00","source_repo":"."}
{"id":"pando-19k","content_hash":"7b5a9b4773d8f6c35d378354f76ab78a8baba121da33521057e5300a80a46911","title":"Implement worktree:list command","description":"Implement src/commands/worktree/list.ts:\n\n- Validate git repository\n- Execute git worktree list command\n- Parse output\n- Format based on --verbose flag\n- Output based on --json flag\n- Use chalk for colored output\n- Handle edge cases (no worktrees, deleted paths)\n\nInclude tests in test/commands/worktree/list.test.ts:\n- List all worktrees\n- JSON output\n- Verbose output\n- Empty worktree list handling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:10.727763-06:00","updated_at":"2025-11-13T04:37:35.588939-06:00","closed_at":"2025-11-13T04:37:35.588939-06:00","source_repo":".","dependencies":[{"issue_id":"pando-19k","depends_on_id":"pando-1s1","type":"blocks","created_at":"2025-11-12T17:03:10.728557-06:00","created_by":"daemon"}]}
{"id":"pando-1s1","content_hash":"7e3059501f80bd1b71fe2b85e9047804a0473c0dc8e5fcee36a430612cfb113c","title":"Implement GitHelper (git.ts) - 12 git operation methods","description":"Implement all 12 methods in src/utils/git.ts GitHelper class:\n\nRepository Methods:\n- isRepository() - Check if current directory is a git repo\n- getRepositoryRoot() - Get git root directory path\n- getMainWorktreePath() - Find main worktree for rsync operations\n\nWorktree Methods:\n- addWorktree() - Add new worktree with options\n- listWorktrees() - List all worktrees with parsing\n- removeWorktree() - Remove worktree with optional force\n- findWorktreeByBranch() - Find worktree by branch name (with fuzzy matching)\n\nBranch Methods:\n- createBranch() - Create new branch from start point\n- deleteBranch() - Delete branch with optional force\n- listBranches() - List all branches\n- branchExists() - Check if branch exists\n- isBranchMerged() - Check merge status for safe deletion\n- getCurrentBranch() - Get current branch name\n\nInclude comprehensive tests in test/utils/git.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:02:31.946116-06:00","updated_at":"2025-11-13T03:49:45.661698-06:00","closed_at":"2025-11-13T03:49:45.661698-06:00","source_repo":"."}
{"id":"pando-1tj","content_hash":"d7bb70a610b82c6088f4029436e93721dcc1bee1877361a5fecfff535c6104f6","title":"Implement branch:delete command","description":"Implement src/commands/branch/delete.ts:\n\n- Check if branch exists and is checked out\n- Check for unmerged changes (unless --force)\n- Optional worktree removal with --remove-worktree\n- Delete branch\n- JSON output support\n\nInclude tests in test/commands/branch/delete.test.ts:\n- Delete branch\n- Required name validation\n- Unmerged branch prevention\n- --force flag\n- --remove-worktree flag\n- JSON output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:11.715713-06:00","updated_at":"2025-11-13T05:05:19.786969-06:00","closed_at":"2025-11-13T05:05:19.786969-06:00","source_repo":".","dependencies":[{"issue_id":"pando-1tj","depends_on_id":"pando-1s1","type":"blocks","created_at":"2025-11-12T17:03:11.716454-06:00","created_by":"daemon"}]}
{"id":"pando-1ya","content_hash":"e8a5a6f022aa5a88465dbb7288bd293156dd743aa1ba4e159d929945d99e6bb1","title":"Implement config:show command","description":"Implement src/commands/config/show.ts:\n\n- Load configuration from all sources\n- Format output (JSON or human-readable)\n- Show sources with --sources flag\n- Use chalk for colored output\n\nNote: No test file exists yet, needs creation in test/commands/config/show.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:11.962177-06:00","updated_at":"2025-11-13T05:19:42.118482-06:00","closed_at":"2025-11-13T05:19:42.118482-06:00","source_repo":".","dependencies":[{"issue_id":"pando-1ya","depends_on_id":"pando-5k3","type":"blocks","created_at":"2025-11-12T17:03:11.962972-06:00","created_by":"daemon"},{"issue_id":"pando-1ya","depends_on_id":"pando-tqc","type":"blocks","created_at":"2025-11-12T17:03:11.963439-06:00","created_by":"daemon"}]}
{"id":"pando-3js","content_hash":"b8a7843d3ab044e3d52e999c8a48a61b357eb961feacc8ebfa6e171fc1b3d4ad","title":"Implement branch:create command","description":"Implement src/commands/branch/create.ts:\n\n- Validate git repository\n- Check if branch already exists\n- Validate base branch/commit\n- Create branch\n- Optional worktree creation with --worktree flag\n- JSON output support\n\nInclude tests in test/commands/branch/create.test.ts:\n- Create new branch\n- Required name validation\n- --from flag\n- --worktree integration\n- JSON output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:11.467543-06:00","updated_at":"2025-11-13T04:59:49.85327-06:00","closed_at":"2025-11-13T04:59:49.85327-06:00","source_repo":".","dependencies":[{"issue_id":"pando-3js","depends_on_id":"pando-1s1","type":"blocks","created_at":"2025-11-12T17:03:11.468295-06:00","created_by":"daemon"}]}
{"id":"pando-3sg","content_hash":"14e63acd772af7eb7681a2fabd0be6cade2b4dcb7c32fd02838269e46e9fdfae","title":"Rebase existing branch onto source when using worktree add","description":"When using `worktree add` with an existing branch, automatically rebase the existing branch onto the source branch.\n\n**Requirements:**\n- Perform rebase after worktree creation when using an existing branch\n- If rebase fails, show a warning but skip it (don't fail the command)\n- Add `--no-rebase` flag to disable the automatic rebase\n- Add config value `worktree.rebaseOnAdd` (boolean, default: true) to control this behavior\n\n**Implementation notes:**\n- Rebase should use `git rebase \u003csource-branch\u003e` on the worktree's branch\n- Handle merge conflicts gracefully - abort rebase and show warning\n- Config should be checked before flag override","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T07:54:30.806325-06:00","updated_at":"2025-11-20T08:13:51.936718-06:00","closed_at":"2025-11-20T08:13:51.936718-06:00","source_repo":"."}
{"id":"pando-5k3","content_hash":"db1861665f292941b82e3c808cc1feba9aede9002c2402d22c68098a70839627","title":"Implement Config Loader (loader.ts) - 9 config file parsers","description":"Implement 9 functions in src/config/loader.ts:\n\n- findConfigFiles() - Walk directory tree to find config files\n- getGlobalConfigPath() - Get global config path\n- configFileExists() - Check file existence\n- parsePandoToml() - Parse .pando.toml files\n- parsePyprojectToml() - Parse pyproject.toml [tool.pando]\n- parseCargoToml() - Parse Cargo.toml [package.metadata.pando]\n- parsePackageJson() - Parse package.json \"pando\" key\n- parseDenoJson() - Parse deno.json \"pando\" key\n- parseComposerJson() - Parse composer.json \"extra.pando\"\n- parseConfigFile() - Parser dispatcher\n\nInclude tests for all file formats and edge cases","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:02:32.758436-06:00","updated_at":"2025-11-13T04:20:44.176114-06:00","closed_at":"2025-11-13T04:20:44.176114-06:00","source_repo":"."}
{"id":"pando-5re","content_hash":"ac92ae8303be5eb6c0d2ea803af0b9f9dbefab39e7e330b07a2eb716604ff58d","title":"Config init should merge missing defaults into existing .pando.toml","description":"When `pando config init` is run and a `.pando.toml` file already exists, instead of erroring (or overwriting with `--force`), the command should intelligently merge missing default settings into the existing file.\n\n**Current Behavior:**\n- Errors if file exists (unless `--force`)\n- `--force` overwrites entire file, losing user customizations\n\n**Desired Behavior:**\n- Detect which settings are missing from existing file\n- Add only the missing settings with their defaults\n- Preserve all existing user customizations\n- Add helpful comments for new settings\n- Optionally show what was added\n\n**Implementation Notes:**\n- Parse existing TOML file\n- Compare against DEFAULT_CONFIG\n- Identify missing keys at all nesting levels\n- Merge defaults for missing keys only\n- Regenerate TOML with proper formatting and comments\n- Consider adding `--merge` flag or making it the default behavior\n- JSON output should show what was added\n\n**Example:**\n```bash\n# Existing .pando.toml has rsync and symlink, but not worktree.deleteBranchOnRemove\npando config init\n# Output: Added 1 missing setting: worktree.deleteBranchOnRemove\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-20T14:38:27.587281-06:00","updated_at":"2025-11-24T18:11:10.771401-06:00","closed_at":"2025-11-24T18:11:10.771401-06:00","source_repo":"."}
{"id":"pando-5v9","content_hash":"95d913562e425e5da46de2ad21211a84104628a9263c27000d489eab821d6de5","title":"Support worktree add with existing git branches","description":"When using `worktree add` with an existing git branch, the command should still successfully create the worktree, perform the rsync, and perform the symlinks. This workflow will likely occur when the user creates the branch ahead of time.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-17T13:18:44.036828-06:00","updated_at":"2025-11-18T16:55:11.650703-06:00","closed_at":"2025-11-18T16:55:11.650703-06:00","source_repo":"."}
{"id":"pando-9j0","content_hash":"79a2cac87fe4ecee68abc1339c0d7520696b02cf5643e01f748c8c94cbf50952","title":"Add branch deletion options to worktree remove","description":"When using `worktree remove`, add an option to delete the associated local and remote branches.\n\n**Requirements:**\n- Add `--delete-branch` flag with options: `none`, `local`, `remote`\n  - `none`: Don't delete any branches (default)\n  - `local`: Delete local branch only\n  - `remote`: Delete both local and remote branches\n- Add config value `worktree.deleteBranchOnRemove` with same options\n\n**Implementation notes:**\n- Should confirm before deleting remote branches (unless `--force` is used)\n- Handle case where branch doesn't exist on remote\n- Show clear output about what was deleted\n- Consider safety: don't delete if branch has unmerged changes (unless forced)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T07:54:30.988955-06:00","updated_at":"2025-11-20T14:33:38.965715-06:00","closed_at":"2025-11-20T14:33:38.965715-06:00","source_repo":"."}
{"id":"pando-bfy","content_hash":"0f4a270ab8aae9b622e92393691d85592f1ad7e2b8c645e9f7deff64b1c6bcc9","title":"Implement FileOpsTransaction (fileOps.ts) - Transaction rollback system","description":"Implement transaction methods in src/utils/fileOps.ts FileOpsTransaction class:\n\n- record() - Record operations for potential rollback\n- createCheckpoint() - Create state snapshots\n- rollback() - Undo operations in reverse order\n- isInstalled() - Check if rsync is installed\n\nInclude tests for transaction rollback scenarios","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:02:32.148868-06:00","updated_at":"2025-11-13T03:53:06.977289-06:00","closed_at":"2025-11-13T03:53:06.977289-06:00","source_repo":".","comments":[{"id":1,"issue_id":"pando-bfy","author":"zpyoung","text":"Implementation complete: All transaction methods (record, createCheckpoint, rollback) and isInstalled are working. All 19 tests passing. Implementation includes:\n- Operation recording with timestamps\n- Checkpoint creation for state snapshots\n- Rollback for CREATE_SYMLINK, RSYNC, CREATE_DIR, DELETE_FILE operations\n- Error handling with graceful degradation\n- RsyncHelper.isInstalled() using execAsync\n- Comprehensive test coverage for all rollback scenarios","created_at":"2025-11-13T09:53:06Z"}]}
{"id":"pando-dli","content_hash":"74f19d51e1aa9b1cf02808bd5106aa27f991fee0312f5d30a217a9e403ebf6c0","title":"Interactive worktree selection for worktree remove","description":"When no path is provided to `worktree remove`, allow the user to interactively select one or more worktrees to remove. This improves usability by eliminating the need to remember or type exact worktree paths.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-17T13:20:18.199584-06:00","updated_at":"2025-11-19T10:09:55.80673-06:00","closed_at":"2025-11-19T10:09:55.80673-06:00","source_repo":"."}
{"id":"pando-ff3","content_hash":"ae198d220206654b914a8f5067ab071bc9c77ac5aa2a6904612f19d4ec670532","title":"A default worktree path should be configurable via the config file","description":"Add support for configurable default worktree path in the configuration system.\n\nCurrently, users must specify the full path with `--path` for every `worktree:add` command. This enhancement would allow users to configure a default base directory for worktrees, making the command more convenient.\n\n**Proposed Configuration:**\n```toml\n[worktree]\ndefaultPath = \"../worktrees\"  # Relative to repo root\n# or\ndefaultPath = \"/Users/username/worktrees\"  # Absolute path\n```\n\n**Implementation Tasks:**\n1. Add `worktree.defaultPath` to config schema (src/config/schema.ts)\n2. Update environment variable parser to support `PANDO_WORKTREE_DEFAULT_PATH`\n3. Update all config file parsers to handle `[worktree]` section\n4. Modify `worktree:add` command to use default path when `--path` is not specified\n5. Support path templates (e.g., `../worktrees/{branch}` for automatic naming)\n6. Update `config:init` to include worktree section in generated TOML\n7. Add tests for default path resolution\n8. Update documentation\n\n**User Experience:**\n```bash\n# After configuration\npando worktree:add --branch feature-x\n# Creates worktree at: ../worktrees/feature-x\n\n# Explicit path still overrides\npando worktree:add --branch feature-x --path /custom/path\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-13T05:37:20.054637-06:00","updated_at":"2025-11-18T07:56:11.760491-06:00","closed_at":"2025-11-18T07:56:11.760491-06:00","source_repo":".","dependencies":[{"issue_id":"pando-ff3","depends_on_id":"pando-mf8","type":"blocks","created_at":"2025-11-13T05:43:19.049789-06:00","created_by":"daemon"}]}
{"id":"pando-k9u","content_hash":"1c969c68863c17fec1f4e60ab66e87ff693191c217c9c2d67ba24596b535dfd9","title":"Refactor worktree:add run() method - break into smaller methods","description":"## Problem\n\nThe `run()` method in `src/commands/worktree/add.ts` is **~340 lines long** (lines 79-420), making it:\n- Hard to read and understand\n- Difficult to test individual components\n- Violates the focused files principle from CLAUDE.md\n- Has high cognitive complexity\n\n## Proposed Refactoring\n\nBreak the monolithic `run()` method into focused, testable private methods:\n\n### Suggested Method Structure:\n\n```typescript\nclass AddWorktree extends Command {\n  // Main orchestration (should be ~30-40 lines)\n  async run(): Promise\u003cvoid\u003e {\n    const { flags } = await this.parse(AddWorktree)\n    const startTime = Date.now()\n    \n    const { spinner, chalk } = await this.initializeUI(flags.json)\n    \n    try {\n      await this.validateAndInitialize(flags, spinner)\n      const config = await this.loadAndMergeConfig(flags, spinner)\n      const worktreeInfo = await this.createWorktree(flags, spinner)\n      const setupResult = await this.runSetup(flags, config, worktreeInfo.path, spinner)\n      await this.formatOutput(flags, worktreeInfo, setupResult, Date.now() - startTime, chalk)\n    } catch (error) {\n      this.handleError(error, flags, chalk, spinner)\n    }\n  }\n\n  // Private helper methods (each 20-50 lines):\n  \n  private async initializeUI(isJson: boolean) {\n    // Import ora and chalk dynamically\n    // Return { spinner, chalk }\n  }\n\n  private async validateAndInitialize(flags, spinner?) {\n    // Phase 1: Initialize and validate (lines 92-120)\n    // - Create GitHelper\n    // - Validate git repo\n    // - Check path exists\n    // - Validate branch/commit combinations\n  }\n\n  private async loadAndMergeConfig(flags, spinner?) {\n    // Phase 2: Load configuration (lines 125-171)\n    // - Get git root\n    // - Load base config\n    // - Load env config\n    // - Apply flag overrides\n    // Return merged config\n  }\n\n  private async createWorktree(flags, spinner?) {\n    // Phase 3: Create worktree (lines 176-190)\n    // - Call gitHelper.addWorktree()\n    // - Handle git errors\n    // Return WorktreeInfo\n  }\n\n  private async runSetup(flags, config, path, spinner?) {\n    // Phase 4: Post-creation setup (lines 195-324)\n    // - Create orchestrator\n    // - Build setup options\n    // - Run setup with progress callback\n    // - Handle setup errors\n    // Return SetupResult\n  }\n\n  private formatOutput(flags, worktreeInfo, setupResult, duration, chalk?) {\n    // Phase 5: Output formatting (lines 329-410)\n    // - JSON output format\n    // - Human-readable output format\n  }\n\n  private handleError(error, flags, chalk?, spinner?) {\n    // Centralized error handling (lines 241-323)\n    // - SetupError\n    // - RsyncNotInstalledError\n    // - SymlinkConflictError\n    // - Generic errors\n  }\n\n  private buildProgressCallback(spinner, flags) {\n    // Extract progress callback logic (lines 201-235)\n    // Return progress callback function\n  }\n}\n```\n\n## Benefits\n\n1. **Improved Readability**: Each method has a single, clear responsibility\n2. **Better Testability**: Can unit test individual methods in isolation\n3. **Reduced Cognitive Load**: Each method is ~20-50 lines instead of 340\n4. **Easier Maintenance**: Changes are localized to specific methods\n5. **Follows Best Practices**: Aligns with CLAUDE.md guidelines for focused files\n\n## Implementation Tasks\n\n1. Create private helper methods for each phase\n2. Extract error handling into dedicated method\n3. Extract UI initialization logic\n4. Extract progress callback creation\n5. Refactor main `run()` to orchestrate the helpers\n6. Update tests to cover new method structure\n7. Ensure no functionality changes (pure refactoring)\n8. Run all tests to verify behavior unchanged\n\n## Testing Strategy\n\n- Existing integration tests should continue to pass\n- Consider adding unit tests for new private methods\n- Use dependency injection for gitHelper to test methods in isolation\n\n## Success Criteria\n\n- [x] `run()` method is \u003c 50 lines\n- [x] No private method \u003e 80 lines\n- [x] All existing tests pass\n- [x] No behavior changes (pure refactoring)\n- [x] Code is more maintainable and testable","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-13T05:45:31.966268-06:00","updated_at":"2025-11-13T09:25:47.648746-06:00","closed_at":"2025-11-13T09:25:47.648746-06:00","source_repo":"."}
{"id":"pando-l0q","content_hash":"14161e25994214da723088ac2d5c784b3ae4982554247c2e745d044af1eac5c5","title":"Implement worktree:remove command","description":"Implement src/commands/worktree/remove.ts:\n\n- Remove worktree at specified path\n- Handle --force flag (skip safety checks)\n- JSON output support\n- Warn about uncommitted changes\n\nInclude tests in test/commands/worktree/remove.test.ts:\n- Remove worktree\n- Required path validation\n- Force flag\n- Uncommitted changes warning\n- JSON output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:11.215452-06:00","updated_at":"2025-11-13T04:52:22.154825-06:00","closed_at":"2025-11-13T04:52:22.154825-06:00","source_repo":".","dependencies":[{"issue_id":"pando-l0q","depends_on_id":"pando-1s1","type":"blocks","created_at":"2025-11-12T17:03:11.216168-06:00","created_by":"daemon"}]}
{"id":"pando-lgg","content_hash":"1c6307e62cacb745e03f1661213689b0ce301ff4b92d51cb7c1ad00515ebe67a","title":"Implement worktree:navigate command","description":"Implement src/commands/worktree/navigate.ts:\n\n- Find worktree by branch or path\n- Verify worktree exists\n- Support --output-path flag\n- Support fuzzy matching for branch names\n- Format output based on --json flag\n\nInclude tests in test/commands/worktree/navigate.test.ts:\n- Navigate by branch\n- Navigate by path\n- Required flags validation\n- --output-path flag\n- JSON output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:10.978821-06:00","updated_at":"2025-11-13T04:42:10.087948-06:00","closed_at":"2025-11-13T04:42:10.087948-06:00","source_repo":".","dependencies":[{"issue_id":"pando-lgg","depends_on_id":"pando-1s1","type":"blocks","created_at":"2025-11-12T17:03:10.980073-06:00","created_by":"daemon"}]}
{"id":"pando-lo6","content_hash":"eeaf64e28f46bb6b6daf13b6d2d82341af391bcb8fd2996ff66ee7e319228680","title":"Switch to space-separated command format (worktree add vs worktree:add)","description":"Current command format uses colon separator: `pando worktree:add`, `pando branch:create`\n\nShould switch to space-separated format to match git conventions: `pando worktree add`, `pando branch create`\n\nBenefits:\n- Matches git's command structure (git worktree add, git branch delete)\n- More familiar to target users (git users)\n- Aligns with modern CLI tools (gh, kubectl, docker)\n- More natural verb-follows-noun structure\n\nAffected commands:\n- worktree:add → worktree add\n- worktree:list → worktree list\n- worktree:remove → worktree remove\n- worktree:navigate → worktree navigate\n- branch:create → branch create\n- branch:delete → branch delete\n- config:init → config init\n- config:show → config show","design":"1. Update package.json oclif configuration:\n   ```json\n   \"oclif\": {\n     \"topicSeparator\": \" \"\n   }\n   ```\n\n2. Update all documentation files:\n   - README.md (all command examples)\n   - CLAUDE.md (all command references)\n   - ARCHITECTURE.md (any command examples)\n   - src/commands/*/DESIGN.md (command examples)\n\n3. Update all command static examples:\n   - Update `\u003c%= command.id %\u003e` usage in examples\n   - Ensure help text reflects space separator\n\n4. Update all test files:\n   - Search for command ID references (e.g., 'worktree:add')\n   - Update to space format (e.g., 'worktree add')\n\n5. Test all commands:\n   - Run `pnpm build`\n   - Test help output: `pnpm dev --help`\n   - Test each command manually\n   - Run full test suite","acceptance_criteria":"- [ ] package.json updated with \"topicSeparator\": \" \"\n- [ ] All documentation updated (README.md, CLAUDE.md, etc.)\n- [ ] All command examples updated in source files\n- [ ] All test files updated with new format\n- [ ] All 273+ tests passing\n- [ ] Manual verification: `pando worktree add --help` works\n- [ ] Manual verification: `pando worktree:add` shows deprecation or error\n- [ ] Build completes successfully","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-13T08:38:40.141198-06:00","updated_at":"2025-11-13T09:18:13.347329-06:00","closed_at":"2025-11-13T09:18:13.347329-06:00","source_repo":"."}
{"id":"pando-m0s","content_hash":"a87ac2d909ef85bae2802e0e9492a5b07c4eadacb244d0a7fe60b0083abc450f","title":"Implement WorktreeSetupManager (worktreeSetup.ts) - Rsync/symlink workflow","description":"Implement complex setup workflow in src/utils/worktreeSetup.ts WorktreeSetupManager:\n\nPhase 3: Create symlinks\nPhase 4: Rsync operations\n- Check rsync installation\n- Build exclude patterns\n- Execute rsync\nPhase 5: Create symlinks after rsync\nPhase 6: Validation\nRollback handling\n\nInclude tests for all phases and rollback scenarios","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:02:32.328477-06:00","updated_at":"2025-11-13T04:08:08.348714-06:00","closed_at":"2025-11-13T04:08:08.348714-06:00","source_repo":"."}
{"id":"pando-mf8","content_hash":"16391864893aaaeddfbb52ff88cf8e15c2a1c93920a95b3bba4c7db89097cb21","title":"loadConfig() should automatically include environment variables","description":"## Problem\n\nCurrently, `ConfigLoader.load()` only loads configuration from files (.pando.toml, package.json, etc.) but **does not** include environment variables. This creates an inconsistent API where every command must remember to:\n\n1. Call `loadConfig()`\n2. Separately call `getEnvConfig()`\n3. Manually merge them with correct priority\n\n**Current workaround in worktree:add** (lines 131-138):\n```typescript\nconst baseConfig = await loadConfig({ cwd: process.cwd(), gitRoot })\nconst envConfig = getEnvConfig()\n```\n\nThis pattern is error-prone and violates the principle of least surprise.\n\n## Expected Priority Order\n\nAccording to CLAUDE.md, the intended priority order is:\n```\nCLI flags (100)        ← Command layer responsibility\n↓\nEnvironment variables (90)  ← Should be in loadConfig()\n↓\n.pando.toml (80)       ← Already in loadConfig()\n↓\nProject files (70-66)  ← Already in loadConfig()\n↓\nGlobal config (50)     ← Already in loadConfig()\n↓\nDefaults (0)           ← Already in loadConfig()\n```\n\n## Proposed Solution\n\n**Modify `ConfigLoader.load()` to automatically include environment variables:**\n\n```typescript\nasync load(options): Promise\u003cPandoConfig\u003e {\n  // ... existing file discovery and parsing ...\n  \n  // Add environment variables with correct priority\n  const envConfig = getEnvConfig()\n  if (hasEnvConfig()) {\n    parsedConfigs.push({\n      config: envConfig,\n      source: ConfigSource.ENV_VARS,\n      priority: 90  // Higher than file configs, lower than CLI flags\n    })\n  }\n  \n  // Merge all configs (now includes env vars)\n  const { config: mergedConfig } = mergeMultipleConfigs(parsedConfigs)\n  \n  return mergedConfig\n}\n```\n\n## Implementation Tasks\n\n1. **Add ConfigSource.ENV_VARS** to the ConfigSource enum in schema.ts\n2. **Update `ConfigLoader.load()`** to include environment variables\n3. **Update `ConfigLoader.loadWithSources()`** for consistency\n4. **Update priority constants** to explicitly define ENV_VARS = 90\n5. **Remove manual getEnvConfig() calls** from command files:\n   - src/commands/worktree/add.ts (lines 136-137)\n   - Any other commands that manually call getEnvConfig()\n6. **Update tests** in test/config/loader.test.ts:\n   - Test that env vars are included automatically\n   - Test correct priority ordering with env vars\n   - Test caching with env vars\n7. **Update documentation** in CLAUDE.md and config/loader.ts comments\n\n## Benefits\n\n- **Simpler API**: Commands just call `loadConfig()` once\n- **Consistent behavior**: All configuration sources handled uniformly\n- **Correct priorities**: Enforced at the loader level\n- **Less error-prone**: No risk of forgetting to load env vars\n- **Better testing**: Single code path to test\n\n## Breaking Changes\n\nNone - this is purely an internal improvement. The external API remains the same.\n\n## Related Issues\n\nThis should be fixed before implementing pando-ff3 (configurable default worktree path), as that feature will add new environment variables.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-13T05:42:57.293233-06:00","updated_at":"2025-11-13T08:59:30.164248-06:00","closed_at":"2025-11-13T08:59:30.164248-06:00","source_repo":"."}
{"id":"pando-n0y","content_hash":"f6da7737e45f018f5b17dfae2ccbd83f211d78aa42b52eb913dfcb9d882e5196","title":"Refactor: Extract common CLI flags to shared module","description":"The `json` flag is duplicated identically across 7 command files:\n- src/commands/worktree/add.ts\n- src/commands/config/show.ts\n- src/commands/branch/delete.ts\n- src/commands/branch/create.ts\n- src/commands/worktree/remove.ts\n- src/commands/worktree/navigate.ts\n- src/commands/worktree/list.ts\n\nThe `force` flag is also duplicated across multiple files.\n\nThese common flags should be extracted to a shared `src/utils/common-flags.ts` module to follow DRY principles and simplify maintenance.","design":"Create `src/utils/common-flags.ts` with:\n1. Export individual flag definitions (jsonFlag, forceFlag)\n2. Export commonFlags object for spreading\n3. Export withCommonFlags() helper function for combining flags\n\nUpdate all 7 affected command files to:\n1. Import shared flag definitions\n2. Replace duplicated code with shared flags\n3. Ensure tests still pass (all 273 tests currently passing)","acceptance_criteria":"- [ ] src/utils/common-flags.ts created with shared flag definitions\n- [ ] All 7 command files updated to use shared flags\n- [ ] No duplicated flag definitions remain\n- [ ] All 273 tests still passing\n- [ ] Code follows existing patterns and TypeScript strict mode","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-13T08:32:56.447837-06:00","updated_at":"2025-11-13T09:10:10.175022-06:00","closed_at":"2025-11-13T09:10:10.175022-06:00","source_repo":"."}
{"id":"pando-tqc","content_hash":"f351d6812bda8f8ecad22968d535c2810b48eea3fd492be3e2520989f6ecfcd8","title":"Implement Environment Config Parser (env.ts) - 5 parsing functions","description":"Implement 5 functions in src/config/env.ts:\n\n- parseBoolean() - Parse boolean from string\n- parseArray() - Parse comma-separated arrays\n- setNestedProperty() - Set nested object properties\n- parseEnvValue() - Parse values based on key type\n- parseEnvVars() - Main environment variable parser\n- listSupportedEnvVars() - List all supported env vars\n\nInclude tests for all parsing scenarios and edge cases","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:02:32.527078-06:00","updated_at":"2025-11-13T04:11:15.793849-06:00","closed_at":"2025-11-13T04:11:15.793849-06:00","source_repo":"."}
{"id":"pando-vz2","content_hash":"ae4c1723d78d3c88e01aecd3e1b10338cbceb6bbda8147fa3537acbd73b9b407","title":"Implement worktree:add command with full rsync/symlink support","description":"Implement src/commands/worktree/add.ts with multi-phase workflow:\n\nPhase 1: Initialize and validate\n- Create GitHelper instance\n- Validate git repository\n- Check path existence and validity\n\nPhase 2: Load configuration\n- Get git root\n- Load config from all sources\n- Merge with command flags\n\nPhase 3-5: Worktree creation with rsync/symlink\n- Create worktree\n- Apply rsync/symlink operations\n- Handle rollback on errors\n\nInclude comprehensive tests in test/commands/worktree/add.test.ts covering:\n- Basic worktree creation\n- JSON output format\n- Required path flag validation\n- Commit hash option\n- Rsync/symlink integration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T17:03:10.455904-06:00","updated_at":"2025-11-13T05:27:54.621086-06:00","closed_at":"2025-11-13T05:27:54.621086-06:00","source_repo":".","dependencies":[{"issue_id":"pando-vz2","depends_on_id":"pando-1s1","type":"blocks","created_at":"2025-11-12T17:03:10.476114-06:00","created_by":"daemon"},{"issue_id":"pando-vz2","depends_on_id":"pando-m0s","type":"blocks","created_at":"2025-11-12T17:03:10.481108-06:00","created_by":"daemon"},{"issue_id":"pando-vz2","depends_on_id":"pando-bfy","type":"blocks","created_at":"2025-11-12T17:03:10.48184-06:00","created_by":"daemon"}]}
{"id":"pando-y5w","content_hash":"5e7e6f9b6eda2a20354cfce370718d92c25515743a4c032ae96882d02724635b","title":"Flatten worktree commands to top-level pando commands","description":"Remove the \"branch\" commands and flatten `worktree` commands to be top-level `pando` commands.\n\n**Changes:**\n- `pando worktree add` → `pando add`\n- `pando worktree list` → `pando list`\n- `pando worktree remove` → `pando remove`\n- `pando worktree navigate` → `pando navigate` (or `pando nav`)\n- `pando worktree symlink` → `pando symlink`\n- Remove all `pando branch *` commands\n\n**Implementation notes:**\n- Move command files from `src/commands/worktree/` to `src/commands/`\n- Update all imports and references\n- Update tests to match new command paths\n- Update README.md and documentation\n- Consider adding aliases for backwards compatibility (optional)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T07:54:31.161696-06:00","updated_at":"2025-11-24T17:17:58.752609-06:00","closed_at":"2025-11-24T17:17:58.752609-06:00","source_repo":"."}
